<div class="sidebar white" style="width: 300px; margin-right: 30px">
  <div style="padding: 30px">
    <div class="heading28" style="margin-bottom: 20px">Overview</div>
    <table class="table table-bordered">
      <tr>
        <td>Live Missions:</td>
        <td><%= Mission.where(:status => "live").count %></td>
      </tr>
      <tr>
        <td>Draft Missions:</td>
        <td><%= Mission.where(:status => "draft").count %></td>
      </tr>
    </table>
    <table class="table table-bordered">
      <tr>
        <td>Total Users:</td>
        <td><%= "#{@total_users} (#{number_to_percentage(@total_fb_users/@total_users.to_f * 100, :precision => 0)} FB)" %></td>
      </tr>
      <tr>
        <td>Activated Users:</td>
        <td><%="#{@total_active_users} (#{number_to_percentage(@total_active_users/@total_users.to_f * 100, :precision => 0)})" %></td>
      </tr>
      <tr>
        <td>Engaged Users:</td>
        <td>work in progress</td>
      </tr>
      <tr>
        <td>Students vs. Teachers ratio</td>
        <td><%= "#{@total_active_students} (#{number_to_percentage(@total_active_students/@total_users.to_f * 100, :precision => 0)})" %> vs. <%= "#{@total_active_teachers} (#{number_to_percentage(@total_active_teachers/@total_users.to_f * 100, :precision => 0)})" %></td>
      </tr>
      <tr>
        <td>Student turned Teacher</td>
        <td>work in progress</td>
      </tr>
    </table>
    <table class="table table-bordered">
      <tr>
        <td>Total Courses:</td>
        <td><%= @total_courses %></td>
      </tr>
      <tr>
        <td>Paying vs. Free ratio</td>
        <td><%= "#{@paying_courses} (#{number_to_percentage(@paying_courses/@total_courses.to_f * 100, :precision => 0)})" %> vs. <%= "#{@free_courses} (#{number_to_percentage(@free_courses/@total_courses.to_f * 100, :precision => 0)})" %></td>
      </tr>
      <tr>
        <td>Courses in draft:</td>
        <td><%= @draft_courses %></td>
      </tr>
    </table>
  </div>
</div>

<div class="tabbable" style="float: left; width: 626px">
  <ul class="nav nav-tabs" style="margin-bottom: 0px;">
    <li class="active"><a href="#tab1" data-toggle="tab" class="heading11">Need Rallying</a></li>
    <li><a href="#tab2" data-toggle="tab" class="heading11">Trends</a></li>
    <li><a href="#tab3" data-toggle="tab" class="heading11">Impact</a></li>
  </ul>
  <div class="tab-content" style="overflow: hidden">
    <div class="tab-pane active" id="tab1">
      <div class="page-main-tab white">
        <div class="page-content">
          <div class="heading28" style="margin-bottom: 20px">Upcoming events in the next 7 days</div>
          <table class="table table-bordered">
            <thead>
              <th>Days from today</th>
              <th>Event</th>
              <th>Status</th>
            </thead>
            <tbody>
              <% @courses_next7days.each do |course| %>
              <tr>
                <td>
                  <% if ((course.starts_at - Time.zone.now) / 60 / 60 / 24).round(0) == 0 %>
                    Today!
                  <% else %>
                    <%= ((course.starts_at - Time.zone.now) / 60 / 60 / 24).round(0) %> day(s)
                  <% end %>
                </td>
                <td>
                  <%= link_to course.title, course %> by <%= link_to course.teacher.name, course.teacher %><br>
                  <div style="font-size: 11px">
                  <% if course.account == nil %>
                    <%= "#{course.mission.verb} #{course.mission.title}" %>
                  <% else %>
                    Partner school: <%= course.account.name %>
                  <% end %><br>
                  <%= course.starts_at.strftime("%a %b %d, %Y") %>, <%= "#{course.starts_at.strftime("%l:%M%p")} - #{course.ends_at.strftime("%l:%M%p")}" %>
                  </div>
                </td>
                <% if course.students.count < course.min_seats %>
                  <td style="background-color: #F5F25D">
                <% else %>
                  <td>
                <% end %>
                  <%= course.students.count %> of <%= course.min_seats %><br>
                  (max. <%= course.max_seats %>)<br>
                </td>
              </tr>
              <% end %>
            </tbody>
          </table>
          <hr>
          <div class="heading28" style="margin-bottom: 20px">Events in draft</div>
          <% Course.where(:account_id => nil).where(:status => "draft").each do |mission| %>
            <div class="heading16 brown"><%= link_to course.title %></div>
            Created by: <%= link_to course.teacher.name, course.teacher %> (<%= course.teacher.email %>)<br>
            Created on: <%= course.created_at.strftime("%a %b %d, %Y") %><br><br>
          <% end %>
          <hr>
          <div class="heading28" style="margin-bottom: 20px">Missions in draft</div>
          <% Mission.where(:account_id => nil).where(:status => "draft").each do |mission| %>
            <div class="heading16 brown"><%= link_to full_mission_title(mission), mission %></div>
            Created by: <%= link_to mission.crewmanships.first.user.name, mission.crewmanships.first.user %> (<%= mission.crewmanships.first.user.email %>)<br>
            Created on: <%= mission.created_at.strftime("%a %b %d, %Y") %><br><br>
          <% end %>
        </div>
      </div><!-- end page main -->
    </div><!-- end tab1 -->

    <div class="tab-pane" id="tab2">
      <div class="page-main-tab white">
        <div class="page-content">
          <div class="heading28" style="margin-bottom: 20px">By month</div>
          <table class="table table-bordered">
            <thead>
              <th>Month</th>
              <th>Members</th>
              <th>Events</th>
            </thead>
            <tbody>
              <% @users_by_month.each do |month, count| %>
                <tr>
                  <td><%= "#{Date::MONTHNAMES[month.last.to_i]}:" %></td>
                  <td><a data-toggle="modal" href="#monthDetail"><%= "#{@users_by_month[month] || 0 } members" %></a></td>
                  <td><%= "#{@courses_by_month[month] ||0} events" %></td>
                </tr>
                <!-- modal begins -->
                <div class="modal hide" id="monthDetail">
                  <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">Ã—</button>
                    <h3><%= "#{Date::MONTHNAMES[month.last.to_i]}:" %></h3>
                  </div>
                  <div class="modal-body">
                  </div>
                </div><!-- modal ends -->
              <% end %>
            </tbody>
          </table>
          <hr>
          <div class="heading28" style="margin-bottom: 20px">By Mission</div>
          <table class="table table-bordered">
            <thead>
              <th>Partner</th>
              <th>Members</th>
              <th>Events</th>
            </thead>
            <tbody>
              <% @accounts.each do |account| %>
                <tr>
                  <td><%= link_to account.name, "http://#{account.subdomain}.hourschool.com" %></td>
                  <td><%= account.memberships.uniq.count %> members</td>
                  <td><%= account.courses.uniq.count %> events</td>
                </tr>
              <% end %>
            </tbody>
          </table>
          <table class="table table-bordered">
            <thead>
              <th>Community</th>
              <th>Members</th>
              <th>Events</th>
            </thead>
            <tbody>
              <% @missions.each do |mission| %>
                <tr>
                  <td><%= link_to full_mission_title(mission), mission %></td>
                  <td><%= mission.crewmanships.count %> members</td>
                  <td><%= mission.courses.count %> events</td>
                </tr>
              <% end %>
            </tbody>
          </table>
          <hr>
          <div class="heading28" style="margin-bottom: 20px">By Member</div>
          <table class="table table-bordered">
            <thead>
              <th>Name</th>
              <th># of events</th>
              <th>Date joined</th>
            </thead>
            <tbody>
              <% @top_users.each do |user| %>
                <tr>
                  <td><%= user.name %></td>
                  <td><%= user.roles.count %></td>
                  <td><%= user.created_at.strftime("%b %d, %Y") %></td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div><!-- end page main -->
    </div><!-- end tab2 -->

    <div class="tab-pane" id="tab3">
      <div class="page-main-tab white">
        <div class="page-content">
          <div class="heading28" style="margin-bottom: 20px">Impact</div>
            How many people taught immediately? (what class and how did that class do?)<br><br>
            How many people went from students to teachers? (from what class, what was the journey from joined to activated to engaged to teach,  and how long did that take?)

            Hero funnel (the rest are just bells and whistles to help people get there):<br>
            When did they join?<br>
            When did they take first action?<br>
            When did they teach their first class?<br>
          <hr>
          Below is a list of people who have both been a student and a teacher. People that have only been student or teacher are excluded.
          <div class="heading14" style="margin: 20px 0px">Student first</div>
          <table class="table table-bordered">
            <thead>
              <th>Name</th>
              <th>Journey</th>
            </thead>
            <tbody>
              <% @teachers.each do |teacher| %>
              <% if teacher.roles.collect(&:name).include?('student') && teacher.roles.collect(&:name).first == "student"  %>
                <tr>
                  <td><%= teacher.name %></td>
                  <td>
                    <% teacher.roles.each do |role| %>
                      <%= role.name %>,
                    <% end %>
                  </td>
                </tr>
                <% end %>
              <% end %>
            </tbody>
          </table>
          <div class="heading14" style="margin-bottom: 20px">Teacher first</div>
          <table class="table table-bordered">
            <thead>
              <th>Name</th>
              <th>Journey</th>
            </thead>
            <tbody>
              <% @teachers.each do |teacher| %>
              <% if teacher.roles.collect(&:name).include?('student') && teacher.roles.collect(&:name).first == "teacher" %>
                <tr>
                  <td><%= teacher.name %></td>
                  <td>
                    <% teacher.roles.each do |role| %>
                      <%= role.name %>,
                    <% end %>
                  </td>
                </tr>
                <% end %>
              <% end %>
            </tbody>
          </table>

        </div>
      </div><!-- end page main -->
    </div><!-- end tab2 -->

  </div><!-- end tab-content -->
</div><!-- end tabbable -->












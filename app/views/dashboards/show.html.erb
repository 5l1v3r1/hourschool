<style type="text/css">
  .mission-stats-16{
    position: relative; 
    z-index: 100; 
    margin-top: 8px; 
    margin-left: 55px; 
    font-weight: 700;
  }

  a{color: #6a4a3b;}
  a:visited{color: #6a4a3b;}
  a:hover{color: #6a4a3b;}
  a:active{color: #6a4a3b;}
</style>

<div class="page-sidebar left" style="width: 243px; margin-right: 27px; border: 0px">
  <% if current_user.photo.present? %>
    <%= image_tag current_user.photo.url(:small) %>
  <% else %>
    <%= image_tag 'v2/Avatars_01_V1.png', :size => "125x125" %>
  <% end %>

  <div style="float: left; padding-bottom: 30px; margin-top: 20px; width: 230px">
    <div class="heading11" style="float: left; margin-top: 30px">Bio</div><br>
    <p style="float: left">
      <% if @user.bio.blank? %>
        No bio yet.
        <%= link_to "Tell us more about you.", edit_user_registration_path(@user) if current_user == @user %>
      <% else %>
        <%= @user.bio %><br>
      <% end %>
    </p>
  </div>
</div>

<div class="heading28 brown" style="float: left; margin-bottom: 20px">
  <%= current_user.name %>
</div>

<% if current_user == @user %>
  <a href="/users/edit" class="btn" style="float: right">Edit my profile</a>
<% else %>
  <a class="btn" style="float: right">Follow</a>
<% end %>

<div class="page-main" style="width: 688px">
  <%#= render :partial => "users/show/comments" %>

  <div class="tabbable"> 
    <ul class="nav nav-tabs" style="margin-bottom: 0px;">
      <li class="active"><a href="#tab1" data-toggle="tab" class="heading11">Journey</a></li>
      <li><a href="#tab2" data-toggle="tab" class="heading11">Missions</a></li>
      <li><a href="#tab3" data-toggle="tab" class="heading11">Followers (<%= @user.followers.count %>)</a></li>
      <li><a href="#tab4" data-toggle="tab" class="heading11">Followings (<%= @user.following.count %>)</a></li>
    </ul>

    <div class="tab-content">
      <div class="tab-pane active" id="tab1">
        <div class="page-main white tab-border main" style="width: 690px">
          <div class="page-content">
            <div id="news-feed">
              <%= render :partial => 'compact_feed_item', :collection => @compact_feed_items %>
            </div>
            <%= render :partial => 'dashboards/paginate' %>
          </div>
        </div>
      </div><!-- end tab1 -->  
      <div class="tab-pane" id="tab2">
        <div class="page-main white tab-border main" style="width: 688px">
          <div style="padding: 20px"> 
            <% if @user.missions.blank? %>
              <div class="well">
                You have not joined any missions yet. <%= link_to "Go explore some!", wall_of_missions_path %>
              </div>
            <% else %>
              <% @user.missions.each do |mission| %>
                <% @crewmanship = mission.crewmanships.where(:user_id => @user.id).first %>
                <div class="mission-divider">                                
                  <%= image_tag(mission.photo.url(:stats)) if mission.photo.present? %>

                  <div style="float: left; width: 648px; background-color: #ececed; height: 42px; border: 1px solid rgba(154, 149, 145, 0.5);">
                      <div class="heading16 adelle" style="padding: 12px 0px 12px 12px"><%= link_to full_mission_title(mission).truncate(75), mission %></div>
                  </div>

                  <div style="float: left; width: 648px; background-color: white; border: 1px solid rgba(154, 149, 145, 0.5); height: 156px; border-top: 0px solid black">
                    <div style="padding: 20px">

                      <div style="float: left; margin-right: 20px">
                        <% if @crewmanship.role == 'explorer' %>
                          <%= image_tag 'v3/badge-explorer.png' %>
                        <% elsif @crewmanship.role == 'guide' %>
                          <%= image_tag 'v3/badge-guide.png' %>
                        <% elsif @crewmanship.role == 'creator' %>
                          <%= image_tag 'v3/badge-creator.png' %>
                        <% elsif @crewmanship.role == 'alumni' %>
                          <%= image_tag 'v3/badge-alumni.png' %>
                        <% end %>
                      </div>

                      <div style="float: left; width: 472px;">

                        <div style="float: left; margin: 0px 20px 20px 0px">
                          
                          <div class="heading16 futura mission-stats-16">
                            <%= @crewmanship.created_at.strftime("%m. %d. %y") %>
                          </div>
                          <div class="heading9 bold" style="margin-left: 55px; color: #ccc">joined on</div>
                          <%= image_tag 'v3/stats-joined-mission.png', :style => "margin-top: -44px" %>
                        </div>

                        <div style="float: left; margin: 0px 20px 20px 0px">
                          <div class="heading16 futura mission-stats-16">
                            <%= (Time.now - @crewmanship.created_at).to_int / 60 / 60 /24 %>
                          </div>
                          <div class="heading9 bold" style="margin-left: 55px; color: #ccc">days on mission</div>
                          <%= image_tag 'v3/stats-mission-days.png', :style => "margin-top: -44px" %>
                        </div>
                        
                        <div style="float: left;">
                          <div class="heading16 futura mission-stats-16">
                            <%= mission.comments.where(:user_id => @user).count %>
                          </div>  
                          <div class="heading9 bold" style="margin-left: 55px; color: #ccc">comments made</div>
                          <%= image_tag 'v3/stats-comments-made.png', :style => "margin-top: -44px" %>
                        </div>
                        
                        <div style="float: left; margin: 0px 20px 20px 0px">  
                          <div class="heading16 futura mission-stats-16">
                            <%= @crewmanship.user.courses_taught.where(:mission_id => mission).count %>
                          </div>
                          <div class="heading9 bold" style="margin-left: 55px; color: #ccc">events hosted</div>
                          <%= image_tag 'v3/stats-events-organized.png', :style => "margin-top: -44px" %>
                        </div>

                        <div style="float: left; margin: 0px 20px 20px 0px">                    
                          <div class="heading16 futura mission-stats-16">
                            <%= @crewmanship.user.courses_attended.where(:mission_id => mission).count %>
                          </div>
                          <div class="heading9 bold" style="margin-left: 53px; color: #ccc">events attended</div>
                          <%= image_tag 'v3/stats-events-attended.png', :style => "margin-top: -44px" %>
                        </div>
                        
                        <div style="float: left;">
                          <div class="heading16 futura mission-stats-16">
                            <%= mission.topics.count %>
                          </div>
                          <div class="heading9 bold" style="margin-left: 55px; color: #ccc">topics created</div>
                          <%= image_tag 'v3/stats-topics-created.png', :style => "margin-top: -44px" %> 
                        </div>
                      </div>

                    </div>
                  </div>
                </div>
              <% end %>
            <% end %>
          </div>
        </div>
      </div><!-- end tab2 --> 
      <div class="tab-pane" id="tab3">
        <div class="page-main white tab-border main" style="width: 688px">
          <div class="page-content">
            <% if @user.followers.blank? %>
              <div class="well">
                You don't have any followers yet. <%= link_to "Join some missions", wall_of_missions_path %> and meet new people! 
              </div>
            <% else %>
              <% @user.followers.each do |user| %>
                <div class="mission-divider">            
                  <div class="crewman-photo">
                    <% if user.photo.present? %>
                      <%= image_tag(user.photo.url(:thumb_large)) %>
                    <% else %>
                      <%= image_tag 'v2/Avatars_01_V1.png', :size => '125x125' %>
                    <% end %>
                  </div>
                  <div class="crewman-description">
                    <div style="font-weight: 700; float: left; margin-right: 10px"><%= user.name %></div>
                    <p><%= user.bio %></p>
                  </div>          
                </div>
              <% end %>
            <% end %>
          </div>
        </div>
      </div><!-- end tab3 -->
      <div class="tab-pane" id="tab4">
        <div class="page-main white tab-border main" style="width: 688px">
          <div class="page-content">
            <% if @user.following.blank? %>
              <div class="well">
                You are not following anyone yet. <%= link_to "Join some missions", wall_of_missions_path %> and meet new people! 
              </div>
            <% else %>
              <% @user.following.each do |user| %>
                <div class="mission-divider">            
                  <div class="crewman-photo">
                    <% if user.photo.present? %>
                      <%= image_tag(user.photo.url(:thumb_large)) %>
                    <% else %>
                      <%= image_tag 'v2/Avatars_01_V1.png', :size => '125x125' %>
                    <% end %>
                    <br><br>
                    <%= link_to "unfollow", user_following_path(:user_id => current_user, :id => user), :method => :delete %>
                  </div>
                  <div class="crewman-description">
                    <div style="font-weight: 700; float: left; margin-right: 10px"><%= user.name %></div>
                    <p><%= user.bio %></p>
                  </div>          
                </div>
              <% end %>
            <% end %>
          </div>
        </div>
      </div><!-- end tab4 --> 


    </div><!-- end tab-content -->
  </div><!-- end tabbable -->

</div>


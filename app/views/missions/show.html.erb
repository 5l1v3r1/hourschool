<%= render 'missions/show/tutorial' %>
<%= render 'missions/show/invitee_landing_page' %>


<div class="full-page">
  <% if @mission.photo.present? %>
    <%= image_tag(@mission.photo, :size => "960x360") %>
  <% else %>
    <div style="background-color: #333; width: 960px; height: 360px;">
      <div class="heading11" style="text-align: center; padding-top: 60px">
        <a data-toggle="modal" href="#addBasicInfo" style="color: white">Upload a photo that represent your mission</a>
      </div>
    </div>
  <% end %> 

  <div class="mission-description-box">
    <div class="heading32 orange">
      <%= @mission.title %>
    </div>

    <div class="heading10">
      <%= "#{@mission.city.name}, #{@mission.city.state}" %>
    </div>

    <p>
      <%= @mission.description %>
    </p>
  </div>

  <div class="mission-status-box">
    <%= link_to 'Join mission', new_mission_crewmanship_path(:mission_id => @mission.id), :class => "orange button short" %>
  </div>

</div><!-- end full page -->


<div class="page-main">
  <div class="tabbable"> 
    <ul class="nav nav-tabs">
      <li class="active"><a href="#tab1" data-toggle="tab" class="heading11">Conversation</a></li>
      <li><a href="#tab2" data-toggle="tab" class="heading11">Events</a></li>
      <li><a href="#tab3" data-toggle="tab" class="heading11">Crew</a></li>
      <li><a href="#tab4" data-toggle="tab" class="heading11">Rally</a></li>
    </ul>
    <div style="padding: 2px 20px 20px 20px">
      <div class="tab-content">
        <div class="tab-pane active" id="tab1">
          <div style="width: 97%">
            <%= render :partial => "missions/show/comments", :locals => {:mission => @mission} %>
          </div>
        </div>     
        <div class="tab-pane" id="tab2">
          <%= link_to "Add an event", new_course_path(:mission_id => @mission.id), :method => :get, :class => "btn", :style => "float: right;" %><br><br>
          <% @courses.each do |course| %>
          <div style="box-shadow: 1px 1px 1px #F0F0F0, 1px 1px 1px 1px #F0F0F0; padding: 10px; margin-top: 10px; margin-bottom: 10px">
              <%= link_to course.title, course, :class => "heading20" %><br>
              Organized by <%= link_to course.teacher.name, course.teacher %><br><br>
        
            <%= image_tag "v2/icon_calendar.png", :style => "margin-top: -3px; margin-right: 5px" %>
            <%= course.starts_at.strftime("%a %b %d") %>, <%= "#{course.starts_at.in_time_zone(course.city.time_zone || course.teacher.time_zone).strftime("%l:%M%p")} - #{course.ends_at.in_time_zone(course.city.time_zone || course.teacher.time_zone).strftime("%l:%M%p")}" %>

            <%= image_tag "v2/icon_location.png", :style => "margin-top: -3px; margin-right: 3px; margin-left: 30px" %>
            <%= course.place_name %>
          </div>
        <% end %>
        </div>
        <div class="tab-pane" id="tab3">
          <%= link_to "Invite someone", new_invite_path(:invitable_id => @mission.id, :invitable_type => "Mission"), :method => :get, :class => "btn", :style => "float: right;" %><br><br>
          <% @users.each do |user| %>
            <div class="crewman-box">
              <div class="crewman-photo">
                <%= image_tag(user.photo.url(:thumb_large)) %>
              </div>
              <div class="crewman-description">
                <div class="heading13-class"><%= user.name %></div>
                <%= user.bio %>
              </div>
            </div><!-- end crewman-box -->
          <% end %>
        </div>
        <div class="tab-pane" id="tab4"><br>
          <div style="box-shadow: 1px 1px 1px #F0F0F0, 1px 1px 1px 1px #F0F0F0; padding: 10px; margin-top: 10px; margin-bottom: 10px">
            <div class="heading32 green">Online Tools</div>
            <ol>
              <li>Invite friends from Facebook</li>
              <li>Invite friends from Twitter</li>
              <li>Write a blog post</li>
            </ul>
          </div>
          <div style="box-shadow: 1px 1px 1px #F0F0F0, 1px 1px 1px 1px #F0F0F0; padding: 10px; margin-top: 10px; margin-bottom: 10px">
            <div class="heading32 green">Printable Tools</div>
          </div>
        </div>

      </div><!-- end tab-content -->

    </div><!-- end page-content -->
  </div><!-- end tabbable -->
</div><!-- end page -->

<div class="page-right-sidebar" style="max-height: 550px; overflow: auto">
  <div class="sidebar-content-white">
      <div class="heading11" style="float: left">Topic Library:</div>
      <a class="btn" data-toggle="modal" href="#newTopic" style="float: right; margin-top: -5px">Add</a>
      <br><br>
      <% @mission.topics.each do |topic| %>
        <div style="box-shadow: 1px 1px 1px #F0F0F0, 1px 1px 1px 1px #F0F0F0; padding: 10px; margin-top: 10px; margin-bottom: 10px">
          <div class="heading13-class"><%= link_to topic.title, mission_topic_path(@mission, topic), :class => "moreInfo" %></div>
          <div class="heading9-class">Added by <%= link_to topic.user.name, topic.user %></div>
          <% if topic.courses.count <= 1 %>
            <%= link_to "#{topic.courses.count} event", mission_topic_path(@mission, topic), :class => "moreInfo" %><br>
          <% else %>
            <%= link_to "#{topic.courses.count} events", mission_topic_path(@mission, topic), :class => "moreInfo" %><br>
          <% end %>
          <%= link_to "Organize something for this topic", new_course_path(:mission_id => @mission.id, :topic_id => topic) %><br>
        </div> 

        <div class="modal hide" id="newTopic">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">Ã—</button>
            <h3>Add a new topic</h3>
          </div>
          <div class="modal-body">              
            <%= render 'topics/form' %>
          </div>
        </div>

        <%= render :layout => 'shared/page/modal', :locals => {:modal_class => 'moreInfoModal'} do %>
          <div class="heading13-class"><%= topic.title %></div>
          <div class="heading9-class">Added by <%= link_to topic.user.name, topic.user %></div>
          <hr>
          <div class="heading11">Related Events:</div>
          <% topic.courses.each do |course| %>
            <%= link_to course.title, course %>
            <br>
          <% end %>
        <% end %><!-- end modal -->

      <% end %><!-- end mission.topic each block -->
  </div>
</div><!-- end sidebar-white -->


<script type="text/javascript">
  $(document).ready( function(){
    $('.moreInfo').bind('click', function(){
      $('.moreInfoModal').show();
      return false;
    })
  });

  $('#newTopic').modal(options)
</script>


